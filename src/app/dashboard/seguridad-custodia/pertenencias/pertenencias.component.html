<app-section-title icon="fa fa-archive" title="Revisi贸n"></app-section-title>

<div class="row">
  <div class="col-md-8">
    <h3>Pertenencias</h3>
  </div>

  <div class="col-md-4">
    <form
      name="search"
      (ngSubmit)="searchImputado()"
      #formSearch="ngForm"
      novalidate
    >
      <div class="input-group">
        <div class="input-group-prepend">
          <span (click)="searchImputado()" class="input-group-text"
            ><i
              class="fa {{ isLoading ? 'fa-spinner fa-spin' : 'fa-search' }}"
            ></i
          ></span>
        </div>
        <input
          name="folio"
          required
          [(ngModel)]="ingreso.folio"
          type="text"
          class="form-control pull-right mr-2"
          placeholder="Buscar por Folio"
        />
      </div>
    </form>
  </div>
</div>

<app-generalidades-ppl
  [generalidadesPPL]="this.ingreso?.imputado"
></app-generalidades-ppl>

<div class="row">
  <div class="col-md-12">
    <hr />
  </div>
  <div class="col-md-8">
    <h3>Revisiones</h3>
  </div>
</div>

<div class="row">
  <div class="col-4">
    <div class="list-group" id="list-tab" role="tablist">
      <a
        *ngFor="let rev of revisiones"
        (click)="selectRevision(rev)"
        class="list-group-item list-group-item-action"
        id="list-home-{{ rev.id }}"
        data-toggle="list"
        href="#list-home-{{ rev.id }}"
        role="tab"
        aria-controls="home"
      >
        {{ rev.horaRevision }}
        {{ rev.fechaRevision | date: "dd/MM/yy" }}
      </a>
      <button
        *ngIf="this.ingreso?.imputado?.id"
        [disabled]="isLoading || !this.ingreso?.imputado?.id"
        (click)="openFormModal(formModal)"
        class="btn btn-success btn-block"
      >
        Agregar
      </button>
    </div>
  </div>
  <div class="col-8">
    <div>
      <div class="tab-pane fade show">
        <app-section-title
          icon="fa fa-list-alt"
          title="Objetos"
        ></app-section-title>
        <div class="row">
          <div class="col text-right mb-3">
            <button
              class="btn btn-success btn-sm m-0 pull-right"
              (click)="add()"
              [disabled]="
                isLoading || !this.ingreso?.imputado?.id || !this.revision?.id
              "
              [ngbTooltip]="'Nuevo Registro'"
            >
              <i class="fa fa-plus fa-lg"></i>
            </button>
            <input
              type="text"
              class="form-control form-control-sm pull-right mr-2"
              style="max-width: 12rem;"
              [(ngModel)]="filter"
              [disabled]="isLoading || !this.ingreso?.imputado?.id"
              placeholder="Buscar"
            />
          </div>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th (click)="sort('descripcion')" class="text-center">
                  <span
                    *ngIf="key == 'descripcion'"
                    class="fa"
                    [ngClass]="{
                      'fa-chevron-circle-down': reverse,
                      'fa-chevron-circle-up': !reverse
                    }"
                  ></span>
                  Nombre
                </th>
                <th class="text-center" style="min-width: 5rem;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr id="table-form" *ngIf="isForm">
                <td class="text-center">
                  <input
                    name="nombre"
                    type="text"
                    class="form-control"
                    [(ngModel)]="objeto.nombre"
                    placeholder="Nombre"
                    #nombre="ngModel"
                    [ngClass]="{
                      'is-invalid': nombre.touched && nombre.invalid
                    }"
                    maxlength="255"
                    required
                  />
                </td>

                <td class="text-center">
                  <i
                    class="fa fa-times mr-3"
                    placement="top"
                    ngbTooltip="Cancelar"
                    (click)="cancel()"
                  ></i>
                  <i
                    class="fa fa-check"
                    placement="top"
                    ngbTooltip="Guardar"
                    (click)="saveObjeto([nombre])"
                  ></i>
                </td>
              </tr>

              <tr
                id="{{ 'tr' + i }}"
                *ngFor="
                  let item of objetos
                    | orderBy: key:reverse
                    | filter: filter
                    | paginate: { itemsPerPage: 5, currentPage: p };
                  let i = index
                "
                (click)="setClickedRow(i)"
              >
                <td class="text-center">{{ item.nombre }}</td>
                <td class="text-center">
                  <i
                    class="fa fa-trash-o"
                    (click)="deleteObjeto(item.id)"
                    placement="top"
                    ngbTooltip="Eliminar"
                  ></i>
                </td>
              </tr>

              <tr *ngIf="objetos.length == 0">
                <td colspan="6">
                  {{ isLoading ? "Cargando..." : "Sin registros..." }}
                </td>
              </tr>
            </tbody>
          </table>
          <div class="text-center w-100">
            <pagination-controls
              autoHide="true"
              responsive="true"
              previousLabel=""
              nextLabel=""
              (pageChange)="switch($event)"
            >
            </pagination-controls>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #formModal let-formModal>
  <div class="modal-body text-center pt-0">
    <app-section-title
      icon="fa fa-archive"
      title="Revisi贸n"
    ></app-section-title>
    <form
      class="form-horizontal"
      name="form"
      (ngSubmit)="f.form.valid && saveRevision()"
      #f="ngForm"
      novalidate
    >
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label class="text-muted" for="">Fecha de Revisi贸n</label>
            <input
              name="numCustodio"
              [(ngModel)]="revision.fechaRevision"
              #fechaRevision="ngModel"
              class="form-control"
              [ngClass]="{
                'is-invalid': f.submitted && fechaRevision.invalid
              }"
              type="date"
              required
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label class="text-muted" for="">Hora de Revisi贸n</label>
            <input
              name="numCustodio"
              [(ngModel)]="revision.horaRevision"
              #horaRevision="ngModel"
              class="form-control"
              [ngClass]="{
                'is-invalid': f.submitted && horaRevision.invalid
              }"
              type="text"
              required
            />
          </div>
        </div>
        <div class="col-sm-12 text-center text-sm-right">
          <button
            type="button"
            (click)="formModal.close()"
            class="btn btn-danger mr-3"
          >
            Cerrar
          </button>
          <button type="submit" [disabled]="isLoading" class="btn btn-success">
            Aceptar
          </button>
        </div>
      </div>
    </form>
  </div>
</ng-template>
